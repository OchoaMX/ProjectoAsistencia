================================================================================
üìö DOCUMENTACI√ìN DE ENDPOINTS/APIs
Sistema de Asistencia Escolar
================================================================================

BASE URL: http://localhost:4000/api

================================================================================
üîê AUTENTICACI√ìN Y SESIONES
================================================================================

POST /api/login
Descripci√≥n: Iniciar sesi√≥n (maestros, prefectos, admin)
Body:
{
  "usuario": "lramirez",
  "contrasena": "pass123"
}
Respuesta:
{
  "success": true,
  "user": {
    "id": 3,
    "nombre": "Luis Ram√≠rez Garc√≠a",
    "usuario": "lramirez",
    "tipoUsuario": "maestro"
  }
}

POST /api/logout
Descripci√≥n: Cerrar sesi√≥n en el servidor
Body: No requiere
Respuesta:
{
  "success": true,
  "message": "Sesi√≥n cerrada exitosamente"
}

GET /api/session
Descripci√≥n: Verificar si hay una sesi√≥n activa
Respuesta:
{
  "success": true,
  "user": {
    "id": 3,
    "nombre": "Luis Ram√≠rez Garc√≠a",
    "usuario": "lramirez",
    "tipoUsuario": "maestro"
  }
}

================================================================================
üéì CARRERAS
================================================================================

GET /api/carreras
Descripci√≥n: Obtener todas las carreras
Respuesta: Array de carreras

GET /api/carreras/:id
Descripci√≥n: Obtener una carrera espec√≠fica
Ejemplo: GET /api/carreras/1

POST /api/carreras
Descripci√≥n: Crear una nueva carrera
Body:
{
  "nombre_carrera": "Ingenier√≠a en Sistemas Computacionales",
  "codigo_carrera": "ISC"
}

PUT /api/carreras/:id
Descripci√≥n: Actualizar una carrera
Body: Igual que POST

DELETE /api/carreras/:id
Descripci√≥n: Eliminar una carrera


================================================================================
üìñ SEMESTRES
================================================================================

GET /api/semestres
Descripci√≥n: Obtener todos los semestres

GET /api/semestres?id_carrera=1
Descripci√≥n: Obtener semestres de una carrera espec√≠fica

GET /api/semestres/carrera/:idCarrera
Descripci√≥n: Obtener semestres de una carrera
Ejemplo: GET /api/semestres/carrera/1

GET /api/semestres/:id
Descripci√≥n: Obtener un semestre espec√≠fico

POST /api/semestres
Descripci√≥n: Crear un semestre
Body:
{
  "id_carrera": 1,
  "numero_semestre": 5,
  "nombre_semestre": "Quinto Semestre"
}

POST /api/semestres/generar
Descripci√≥n: Generar m√∫ltiples semestres autom√°ticamente
Body:
{
  "id_carrera": 1,
  "cantidad_semestres": 9
}

PUT /api/semestres/:id
Descripci√≥n: Actualizar un semestre

DELETE /api/semestres/:id
Descripci√≥n: Eliminar un semestre


================================================================================
üìö MATERIAS
================================================================================

GET /api/materias
Descripci√≥n: Obtener todas las materias

GET /api/materias?id_carrera=1
Descripci√≥n: Filtrar materias por carrera

GET /api/materias/:id
Descripci√≥n: Obtener una materia espec√≠fica

POST /api/materias
Descripci√≥n: Crear una nueva materia
Body:
{
  "id_carrera": 1,
  "id_semestre": 3,
  "nombre_materia": "Bases de Datos",
  "codigo_materia": "BD-302"
}
Nota: Autom√°ticamente se agrega al Plan de Estudios

PUT /api/materias/:id
Descripci√≥n: Actualizar una materia

DELETE /api/materias/:id
Descripci√≥n: Eliminar una materia


================================================================================
üìã PLAN DE ESTUDIOS
================================================================================

GET /api/plan-estudios
Descripci√≥n: Obtener todo el plan de estudios

GET /api/plan-estudios?id_carrera=1
Descripci√≥n: Obtener plan de estudios de una carrera

GET /api/plan-estudios/carrera/:idCarrera
Descripci√≥n: Obtener plan de estudios completo de una carrera
Ejemplo: GET /api/plan-estudios/carrera/1

GET /api/plan-estudios/materias/:idCarrera/:idSemestre
Descripci√≥n: Obtener materias de un semestre espec√≠fico (IMPORTANTE para asignaciones)
Ejemplo: GET /api/plan-estudios/materias/1/5
Uso: Filtrar materias cuando se selecciona un grupo

GET /api/plan-estudios/:id
Descripci√≥n: Obtener un registro espec√≠fico del plan

POST /api/plan-estudios
Descripci√≥n: Asignar una materia a un semestre
Body:
{
  "id_carrera": 1,
  "id_semestre": 5,
  "id_materia": 2
}

DELETE /api/plan-estudios/:id
Descripci√≥n: Quitar una materia del plan de estudios


================================================================================
üë• GRUPOS
================================================================================

GET /api/grupos
Descripci√≥n: Obtener todos los grupos

GET /api/grupos?id_carrera=1
Descripci√≥n: Filtrar grupos por carrera

GET /api/grupos?id_carrera=1&id_semestre=3
Descripci√≥n: Filtrar grupos por carrera Y semestre

GET /api/grupos/:id
Descripci√≥n: Obtener un grupo espec√≠fico

POST /api/grupos
Descripci√≥n: Crear un nuevo grupo
Body:
{
  "id_carrera": 1,
  "id_semestre": 5,
  "nombre_grupo": "502",
  "turno": "Matutino",
  "periodo": "Enero-Junio",
  "anio": 2025
}

PUT /api/grupos/:id
Descripci√≥n: Actualizar un grupo

DELETE /api/grupos/:id
Descripci√≥n: Eliminar un grupo


================================================================================
üéì ALUMNOS
================================================================================

GET /api/alumnos
Descripci√≥n: Obtener todos los alumnos

GET /api/alumnos/grupo/:idGrupo
Descripci√≥n: Obtener alumnos de un grupo espec√≠fico (IMPORTANTE para pasar lista)
Ejemplo: GET /api/alumnos/grupo/5
Uso: Panel de maestro - cargar lista de alumnos

GET /api/alumnos/matricula/:matricula
Descripci√≥n: Buscar alumno por matr√≠cula
Ejemplo: GET /api/alumnos/matricula/2023001

GET /api/alumnos/:id
Descripci√≥n: Obtener un alumno espec√≠fico

POST /api/alumnos
Descripci√≥n: Registrar un nuevo alumno
Body:
{
  "matricula": "2023001",
  "nombre_alumno": "Juan",
  "apellido_paterno": "P√©rez",
  "apellido_materno": "L√≥pez",
  "id_carrera": 1,
  "id_semestre": 3,
  "id_grupo": 1,
  "foto_base64": "data:image/jpeg;base64,..."
}

PUT /api/alumnos/:id
Descripci√≥n: Actualizar un alumno

POST /api/alumnos/importar-csv
Descripci√≥n: Importar m√∫ltiples alumnos desde archivo CSV
Body:
{
  "alumnos": [
    {
      "matricula": "240460093-0",
      "nombre_alumno": "JUAN CARLOS",
      "apellido_paterno": "ACOSTA",
      "apellido_materno": "BARRON",
      "id_carrera": 1,
      "id_semestre": 3,
      "id_grupo": 1,
      "activo": true
    }
  ]
}
Respuesta:
{
  "message": "Importaci√≥n completada. 10 alumnos importados correctamente, 2 omitidos",
  "importados": 10,
  "omitidos": 2,
  "total": 12,
  "errores": ["Matr√≠cula 240460093-0: ya existe"]
}
Nota: Omite autom√°ticamente matr√≠culas duplicadas. Ver ejemplo_importar_alumnos.csv

DELETE /api/alumnos/:id
Descripci√≥n: Eliminar un alumno
Query Params (opcionales):
  - forzar=true: Elimina tambi√©n los registros de asistencia del alumno
Respuesta (si tiene asistencias y no se forz√≥):
{
  "error": "No se puede eliminar porque tiene 2 registros de asistencia",
  "success": false,
  "tieneAsistencias": true,
  "totalAsistencias": 2
}
Nota: Si el alumno tiene asistencias, el sistema pide confirmaci√≥n. Al confirmar,
      se eliminan primero las asistencias y luego el alumno.


================================================================================
üë®‚Äçüè´ MAESTROS
================================================================================

GET /api/maestros
Descripci√≥n: Obtener todos los maestros

GET /api/maestros/:id
Descripci√≥n: Obtener un maestro espec√≠fico

GET /api/maestros/:id/completo
Descripci√≥n: Obtener informaci√≥n completa del maestro

POST /api/maestros
Descripci√≥n: Registrar un nuevo maestro
Body:
{
  "nombre_completo": "Luis",
  "apellido_paterno": "Ram√≠rez",
  "apellido_materno": "Garc√≠a",
  "nombre_usuario": "lramirez",
  "contrasena": "pass123"
}

PUT /api/maestros/:id
Descripci√≥n: Actualizar un maestro

DELETE /api/maestros/:id
Descripci√≥n: Eliminar un maestro


================================================================================
‚è∞ HORARIOS
================================================================================

GET /api/horarios
Descripci√≥n: Obtener todos los horarios (40 bloques: 8 por d√≠a x 5 d√≠as)

GET /api/horarios/disponibles?id_grupo=5&id_maestro=3
Descripci√≥n: Obtener horarios disponibles (no ocupados)
Uso: Al crear asignaciones - mostrar solo horarios libres

GET /api/horarios/:id
Descripci√≥n: Obtener un horario espec√≠fico


================================================================================
üìÖ ASIGNACIONES (Horarios de Clases)
================================================================================

GET /api/asignaciones
Descripci√≥n: Obtener todas las asignaciones

GET /api/asignaciones?id_maestro=3
Descripci√≥n: Obtener asignaciones de un maestro (IMPORTANTE para panel docente)
Uso: Cargar grupos y materias que imparte el maestro

GET /api/asignaciones?id_grupo=5
Descripci√≥n: Obtener asignaciones de un grupo

GET /api/asignaciones/:id
Descripci√≥n: Obtener una asignaci√≥n espec√≠fica

POST /api/asignaciones
Descripci√≥n: Crear una nueva asignaci√≥n
Body:
{
  "id_grupo": 5,
  "id_materia": 2,
  "id_maestro": 3,
  "id_horario": 1
}

PUT /api/asignaciones/:id
Descripci√≥n: Actualizar una asignaci√≥n

DELETE /api/asignaciones/:id
Descripci√≥n: Eliminar una asignaci√≥n


================================================================================
‚úÖ ASISTENCIAS (TOMA DE LISTA)
================================================================================

GET https://projectoasistencia.onrender.com/api/asistencias
Descripci√≥n: Obtener todas las asistencias

GET https://projectoasistencia.onrender.com/api/asistencias?id_grupo=5
Descripci√≥n: Obtener asistencias de un grupo (IMPORTANTE para hist√≥rico)
Uso: Panel de maestro - ver hist√≥rico de un grupo

GET https://projectoasistencia.onrender.com/api/asistencias?id_asignacion=1
Descripci√≥n: Filtrar por asignaci√≥n espec√≠fica

GET https://projectoasistencia.onrender.com/api/asistencias?fecha=2025-10-15
Descripci√≥n: Filtrar por fecha

GET https://projectoasistencia.onrender.com/api/asistencias?id_alumno=1
Descripci√≥n: Filtrar por alumno

GET https://projectoasistencia.onrender.com/api/asistencias/lista-alumnos?id_asignacion=1
Descripci√≥n: Obtener lista de alumnos para tomar asistencia
Uso: Preparar interfaz de toma de lista

POST https://projectoasistencia.onrender.com/api/asistencias/registrar
Descripci√≥n: Registrar asistencia de m√∫ltiples alumnos (IMPORTANTE - Panel Maestro)
Body:
{
  "id_asignacion": 1,
  "fecha": "2025-10-15",
  "asistencias": [
    {
      "id_alumno": 1,
      "estado": "asistencia",
      "observaciones": null
    },
    {
      "id_alumno": 2,
      "estado": "falta",
      "observaciones": null
    }
  ]
}
Respuesta:
{
  "success": true,
  "message": "Asistencias registradas exitosamente",
  "data": {
    "registradas": 2,
    "fecha": "2025-10-15"
  }
}

Estados v√°lidos: "asistencia", "falta", "justificante"


================================================================================
üë§ USUARIOS DEL SISTEMA (Admin y Prefectos)
================================================================================

GET /api/usuarios
Descripci√≥n: Obtener usuarios del sistema (admin/prefecto)

GET /api/usuarios/:id
Descripci√≥n: Obtener un usuario espec√≠fico

POST /api/usuarios
Descripci√≥n: Crear un usuario (admin o prefecto)
Body:
{
  "nombreUsuario": "prefecto1",
  "contrasena": "123456",
  "tipoUsuario": "prefecto",
  "nombre": "Juan P√©rez"
}
Nota: Los campos deben ser en camelCase (nombreUsuario, tipoUsuario)
El campo "nombre" es requerido para prefectos

PUT /api/usuarios/:id
Descripci√≥n: Actualizar un usuario
Body: Igual que POST

DELETE /api/usuarios/:id
Descripci√≥n: Eliminar un usuario


================================================================================
üìä PORTAL DE PREFECTOS - DASHBOARD
================================================================================

GET /api/prefectos/tendencia-asistencia?dias=30
Descripci√≥n: Obtener tendencia de asistencia general
Par√°metros opcionales:
  - dias: Periodo a analizar (default: 30)
Respuesta:
{
  "success": true,
  "data": [
    {
      "fecha": "2025-10-15",
      "porcentaje_asistencia": 85.5,
      "total_registros": 120,
      "asistencias": 103,
      "faltas": 17
    }
  ]
}

GET /api/prefectos/ranking-grupos?limite=10
Descripci√≥n: Obtener ranking de grupos por asistencia
Par√°metros opcionales:
  - limite: N√∫mero de grupos a mostrar (default: 10)
  - orden: 'DESC' para mejores, 'ASC' para peores
Respuesta:
{
  "success": true,
  "data": [
    {
      "id_grupo": 5,
      "nombre_grupo": "502",
      "carrera": "ISC",
      "semestre": "5",
      "porcentaje_asistencia": 92.5,
      "total_alumnos": 30
    }
  ]
}

GET /api/prefectos/alertas?dias=7
Descripci√≥n: Obtener alertas de asistencia
Par√°metros opcionales:
  - dias: Periodo a analizar (default: 7)
Respuesta:
{
  "success": true,
  "data": [
    {
      "tipo": "alumno",
      "prioridad": "alta",
      "mensaje": "Juan P√©rez tiene 5 faltas en los √∫ltimos 7 d√≠as",
      "id_alumno": 1,
      "id_grupo": 5
    }
  ]
}

GET /api/prefectos/grupos-excelentes?periodo=30
Descripci√≥n: Obtener grupos con excelente asistencia (‚â• 90%)
Par√°metros opcionales:
  - periodo: D√≠as a analizar (default: 30)
Respuesta:
{
  "success": true,
  "data": [
    {
      "id_grupo": 5,
      "nombre_grupo": "502",
      "carrera": "Ingenier√≠a en Sistemas",
      "semestre": "5",
      "porcentaje_asistencia": 95.5,
      "total_clases": 45,
      "asistencias": 43
    }
  ]
}

GET /api/prefectos/grupos-criticos?periodo=30
Descripci√≥n: Obtener grupos con baja asistencia (< 70%)
Par√°metros opcionales:
  - periodo: D√≠as a analizar (default: 30)
Respuesta:
{
  "success": true,
  "data": [
    {
      "id_grupo": 3,
      "nombre_grupo": "302",
      "carrera": "Ingenier√≠a Industrial",
      "semestre": "3",
      "porcentaje_asistencia": 65.2,
      "total_clases": 40,
      "asistencias": 26
    }
  ]
}


================================================================================
üìä PORTAL DE PREFECTOS - ALUMNOS PROBLEM√ÅTICOS
================================================================================

GET /api/prefectos/alumnos-problematicos
Descripci√≥n: Obtener lista de alumnos con problemas de asistencia
Par√°metros opcionales (query):
  - periodo: D√≠as a analizar (default: 30)
  - minimo_faltas: M√≠nimo de faltas para considerar (default: 3)
  - id_carrera: Filtrar por carrera
  - id_semestre: Filtrar por semestre
  - id_grupo: Filtrar por grupo
  - nombre: Buscar por nombre
Ejemplo: GET /api/prefectos/alumnos-problematicos?periodo=30&minimo_faltas=5&id_carrera=1
Respuesta:
{
  "success": true,
  "data": [
    {
      "id_alumno": 1,
      "matricula": "2023001",
      "nombre_completo": "Juan P√©rez L√≥pez",
      "grupo": "502",
      "carrera": "ISC",
      "semestre": "5",
      "total_faltas": 8,
      "total_asistencias": 12,
      "total_justificantes": 1,
      "porcentaje_asistencia": 60.0
    }
  ]
}

GET /api/prefectos/alumno/:id?periodo=30
Descripci√≥n: Obtener detalle completo de un alumno
Par√°metros opcionales:
  - periodo: D√≠as a analizar (default: 30)
Ejemplo: GET /api/prefectos/alumno/1?periodo=30
Respuesta:
{
  "success": true,
  "data": {
    "info_alumno": { ... },
    "estadisticas": {
      "total_faltas": 8,
      "total_asistencias": 12,
      "porcentaje_asistencia": 60.0
    },
    "historico": [ ... ],
    "faltas_por_materia": [ ... ]
  }
}

POST /api/prefectos/atencion-alumno
Descripci√≥n: Marcar un alumno como atendido
Body:
{
  "id_alumno": 1,
  "notas": "Reuni√≥n con padres programada"
}
Respuesta:
{
  "success": true,
  "message": "Atenci√≥n registrada exitosamente",
  "data": {
    "id_atencion": 5,
    "fecha_atencion": "2025-10-23"
  }
}

GET /api/prefectos/atencion-alumno/:id
Descripci√≥n: Verificar si un alumno ha sido atendido
Ejemplo: GET /api/prefectos/atencion-alumno/1
Respuesta:
{
  "success": true,
  "atendido": true,
  "data": {
    "id_atencion": 5,
    "fecha_atencion": "2025-10-23",
    "prefecto": "Juan P√©rez"
  }
}

GET /api/prefectos/alumnos-atendidos?dias=90
Descripci√≥n: Obtener lista de alumnos que han sido atendidos
Par√°metros opcionales:
  - dias: Periodo a consultar (default: 90)
Respuesta:
{
  "success": true,
  "data": [
    {
      "id_alumno": 1,
      "ultima_atencion": "2025-10-23",
      "prefecto": "Juan P√©rez"
    }
  ]
}

DELETE /api/prefectos/atencion-alumno/:id
Descripci√≥n: Desmarcar un alumno como atendido
Ejemplo: DELETE /api/prefectos/atencion-alumno/1
Respuesta:
{
  "success": true,
  "message": "Registro de atenci√≥n eliminado"
}


================================================================================
üìä PORTAL DE PREFECTOS - MAESTROS
================================================================================

GET /api/prefectos/maestros-problematicos
Descripci√≥n: Obtener maestros con bajo cumplimiento de registro
Par√°metros opcionales (query):
  - periodo: D√≠as a analizar (default: 30)
  - minimo_cumplimiento: % m√≠nimo de cumplimiento (default: 80)
  - limite: N√∫mero de resultados (default: 20)
Ejemplo: GET /api/prefectos/maestros-problematicos?periodo=30&minimo_cumplimiento=70
Respuesta:
{
  "success": true,
  "data": [
    {
      "id_maestro": 3,
      "nombre_completo": "Luis Ram√≠rez Garc√≠a",
      "total_clases_programadas": 20,
      "total_registros": 15,
      "porcentaje_cumplimiento": 75.0,
      "materias_impartidas": 2,
      "grupos_asignados": 3
    }
  ]
}

GET /api/prefectos/maestro/:id?periodo=30
Descripci√≥n: Obtener detalle completo de un maestro
Par√°metros opcionales:
  - periodo: D√≠as a analizar (default: 30)
Ejemplo: GET /api/prefectos/maestro/3?periodo=30
Respuesta:
{
  "success": true,
  "data": {
    "info_maestro": { ... },
    "estadisticas": {
      "total_clases_programadas": 20,
      "total_registros": 15,
      "porcentaje_cumplimiento": 75.0
    },
    "asignaciones": [ ... ],
    "registros_recientes": [ ... ]
  }
}

GET /api/prefectos/maestros-historico
Descripci√≥n: Buscar registros hist√≥ricos de asistencia de maestros
Par√°metros opcionales (query):
  - fecha_inicio: Fecha de inicio (YYYY-MM-DD)
  - fecha_fin: Fecha de fin (YYYY-MM-DD)
  - id_maestro: Filtrar por maestro espec√≠fico
  - id_grupo: Filtrar por grupo espec√≠fico
  - id_materia: Filtrar por materia espec√≠fica
Ejemplo: GET /api/prefectos/maestros-historico?fecha_inicio=2025-10-01&fecha_fin=2025-10-23
Respuesta:
{
  "success": true,
  "data": [
    {
      "id_asistencia": 1,
      "fecha": "2025-10-15",
      "maestro": "Luis Ram√≠rez Garc√≠a",
      "grupo": "502",
      "materia": "Bases de Datos",
      "total_alumnos": 30,
      "asistencias": 25,
      "faltas": 5,
      "porcentaje": 83.3
    }
  ]
}


================================================================================
üìä VISUALIZACI√ìN Y ESTAD√çSTICAS
================================================================================

GET /api/estructura?idCarrera=1&idSemestre=3&idGrupo=5
Descripci√≥n: Obtener estructura del sistema (carreras, grupos, alumnos)
Todos los par√°metros son opcionales

GET /api/estadisticas/grupo?id_grupo=5&fecha_inicio=2025-01-01&fecha_fin=2025-12-31
Descripci√≥n: Obtener estad√≠sticas de asistencia de un grupo


================================================================================
üí° TIPS IMPORTANTES
================================================================================

1. AUTENTICACI√ìN CON SESIONES:
   - Todas las peticiones usan cookies de sesi√≥n
   - Incluir { credentials: 'include' } en fetch()
   - La sesi√≥n expira despu√©s de inactividad
   - Verificar sesi√≥n peri√≥dicamente con GET /api/session

2. FILTROS EN CASCADA (Carrera ‚Üí Semestre ‚Üí Grupo):
   - Primero: GET /api/carreras
   - Luego: GET /api/semestres?id_carrera=X
   - Luego: GET /api/grupos?id_carrera=X&id_semestre=Y

3. MATERIAS POR SEMESTRE (para asignaciones):
   - Usar: GET /api/plan-estudios/materias/:idCarrera/:idSemestre
   - Esto asegura que solo se muestren materias del semestre del grupo

4. TOMA DE ASISTENCIA (flujo completo):
   a) GET /api/asignaciones?id_maestro=X  (grupos del maestro)
   b) GET /api/alumnos/grupo/Y            (alumnos del grupo)
   c) POST /api/asistencias/registrar     (guardar asistencias)

5. HORARIOS DISPONIBLES (para asignaciones):
   - Usar: GET /api/horarios/disponibles?id_grupo=X&id_maestro=Y
   - Esto evita conflictos de horarios

6. FORMATO DE DATOS:
   - Fechas: "YYYY-MM-DD" (ejemplo: "2025-10-15")
   - Horas: "HH:MM:SS" (ejemplo: "08:30:00")
   - Fotos: Base64 con prefijo "data:image/jpeg;base64,..."

7. TIPOS DE USUARIOS:
   - "admin": Administrador del sistema
   - "maestro": Docente que imparte clases
   - "prefecto": Personal administrativo

8. ESTADOS DE ASISTENCIA:
   - "asistencia": El alumno asisti√≥
   - "falta": El alumno no asisti√≥
   - "justificante": El alumno tiene justificaci√≥n

9. CIERRE DE SESI√ìN:
   - Siempre usar sessionStorage.setItem('loggingOut', 'true')
   - Llamar a POST /api/logout
   - Limpiar localStorage
   - Redirigir a /

================================================================================
üîÑ FLUJOS COMUNES
================================================================================

FLUJO 1: REGISTRAR UN ALUMNO
1. GET /api/carreras                    ‚Üí Seleccionar carrera
2. GET /api/semestres?id_carrera=X     ‚Üí Seleccionar semestre
3. GET /api/grupos?id_carrera=X&id_semestre=Y  ‚Üí Seleccionar grupo
4. POST /api/alumnos                   ‚Üí Guardar alumno

FLUJO 2: CREAR UNA ASIGNACI√ìN (Asignar maestro a grupo)
1. GET /api/carreras                   ‚Üí Seleccionar carrera
2. GET /api/grupos?id_carrera=X        ‚Üí Seleccionar grupo
3. GET /api/plan-estudios/materias/X/Y ‚Üí Materias del semestre del grupo
4. GET /api/maestros                   ‚Üí Seleccionar maestro
5. GET /api/horarios/disponibles?id_grupo=G&id_maestro=M ‚Üí Horarios libres
6. POST /api/asignaciones              ‚Üí Crear asignaci√≥n

FLUJO 3: TOMAR ASISTENCIA (Panel Maestro)
1. Login del maestro
2. GET /api/asignaciones?id_maestro=X  ‚Üí Obtener grupos y materias
3. Seleccionar grupo ‚Üí Filtrar materias del array
4. GET /api/alumnos/grupo/Y            ‚Üí Cargar lista de alumnos
5. Marcar asistencias en interfaz
6. POST /api/asistencias/registrar     ‚Üí Guardar todas las asistencias

FLUJO 4: VER HIST√ìRICO DE ASISTENCIAS
1. GET /api/asignaciones?id_maestro=X  ‚Üí Obtener grupos del maestro
2. Seleccionar grupo
3. GET /api/asistencias?id_grupo=Y     ‚Üí Obtener hist√≥rico
4. Filtrar por fechas en frontend (opcional)

FLUJO 5: DASHBOARD DE PREFECTO
1. Login como prefecto
2. GET /api/prefectos/tendencia-asistencia?dias=30 ‚Üí Gr√°fica de tendencia
3. GET /api/prefectos/ranking-grupos?limite=10 ‚Üí Top/Bottom grupos
4. GET /api/prefectos/alertas?dias=7 ‚Üí Alertas recientes
5. GET /api/prefectos/grupos-excelentes ‚Üí Grupos con >90%
6. GET /api/prefectos/grupos-criticos ‚Üí Grupos con <70%

FLUJO 6: ALUMNOS PROBLEM√ÅTICOS (Prefecto)
1. GET /api/prefectos/alumnos-problematicos?periodo=30&minimo_faltas=5
2. GET /api/prefectos/alumnos-atendidos ‚Üí Verificar atendidos
3. Seleccionar alumno ‚Üí GET /api/prefectos/alumno/:id
4. Marcar como atendido ‚Üí POST /api/prefectos/atencion-alumno
5. Generar citatorio (frontend con jsPDF)

FLUJO 7: MAESTROS PROBLEM√ÅTICOS (Prefecto)
1. GET /api/prefectos/maestros-problematicos?periodo=30
2. Seleccionar maestro ‚Üí GET /api/prefectos/maestro/:id
3. Ver hist√≥rico ‚Üí GET /api/prefectos/maestros-historico?id_maestro=X
4. Generar reporte (frontend con jsPDF)

FLUJO 8: CERRAR SESI√ìN (Cualquier usuario)
1. sessionStorage.setItem('loggingOut', 'true')
2. POST /api/logout ‚Üí Cerrar en servidor
3. localStorage.removeItem('user')
4. Redirigir a /

================================================================================
‚ö†Ô∏è VALIDACIONES Y RESTRICCIONES
================================================================================

1. No se puede eliminar una carrera si tiene semestres, materias o grupos
2. No se puede eliminar un semestre si tiene registros en plan de estudios o grupos
3. No se puede eliminar una materia si tiene asignaciones activas
4. No se puede eliminar un grupo si tiene alumnos asignados
5. No se puede eliminar un maestro si tiene asignaciones de materias
6. No se puede eliminar un alumno si tiene registros de asistencia
7. Un horario no puede estar ocupado por el mismo grupo o maestro dos veces
8. Las materias solo se pueden asignar si est√°n en el plan de estudios del semestre
9. Todos los endpoints de prefectos requieren autenticaci√≥n con rol "prefecto"
10. Las sesiones expiran despu√©s de 24 horas de inactividad

================================================================================
üì± ENDPOINTS ESPEC√çFICOS PARA PANEL DE MAESTRO
================================================================================

CARGAR GRUPOS ASIGNADOS:
GET /api/asignaciones?id_maestro={id_maestro}
Devuelve:
- Todos los grupos donde el maestro imparte clases
- Materias que imparte en cada grupo
- Horarios de cada materia

CARGAR ALUMNOS PARA PASAR LISTA:
GET /api/alumnos/grupo/{id_grupo}
Devuelve:
- Lista completa de alumnos del grupo
- Incluye fotos en Base64
- Informaci√≥n de carrera y semestre

GUARDAR ASISTENCIAS:
POST /api/asistencias/registrar
Body:
{
  "id_asignacion": 1,
  "fecha": "2025-10-15",
  "asistencias": [
    {"id_alumno": 1, "estado": "asistencia", "observaciones": null},
    {"id_alumno": 2, "estado": "falta", "observaciones": null},
    {"id_alumno": 3, "estado": "justificante", "observaciones": "Cita m√©dica"}
  ]
}

VER HIST√ìRICO:
GET /api/asistencias?id_grupo={id_grupo}
Devuelve:
- Todos los registros de asistencia del grupo
- Se puede filtrar por fecha en frontend

================================================================================
üì± ENDPOINTS ESPEC√çFICOS PARA PORTAL DE PREFECTOS
================================================================================

DASHBOARD:
- GET /api/prefectos/tendencia-asistencia
- GET /api/prefectos/ranking-grupos
- GET /api/prefectos/alertas
- GET /api/prefectos/grupos-excelentes
- GET /api/prefectos/grupos-criticos

ALUMNOS PROBLEM√ÅTICOS:
- GET /api/prefectos/alumnos-problematicos (con filtros)
- GET /api/prefectos/alumno/:id (detalle completo)
- POST /api/prefectos/atencion-alumno (marcar atendido)
- GET /api/prefectos/atencion-alumno/:id (verificar estado)
- GET /api/prefectos/alumnos-atendidos (lista de atendidos)
- DELETE /api/prefectos/atencion-alumno/:id (desmarcar)

MAESTROS:
- GET /api/prefectos/maestros-problematicos (con filtros)
- GET /api/prefectos/maestro/:id (detalle completo)
- GET /api/prefectos/maestros-historico (b√∫squeda hist√≥rica)

TODAS REQUIEREN:
- Autenticaci√≥n con rol "prefecto"
- credentials: 'include' en fetch()
- Sesi√≥n activa en el servidor

================================================================================
üé® RESPUESTAS EST√ÅNDAR
================================================================================

√âXITO (200-201):
{
  "success": true,
  "message": "Operaci√≥n exitosa",
  "data": { ... }
}

ERROR (400-500):
{
  "error": "Mensaje de error descriptivo"
}

VALIDACI√ìN (400):
{
  "error": "Los siguientes campos son requeridos: nombreUsuario, tipoUsuario"
}

NO AUTORIZADO (401):
{
  "error": "No autorizado",
  "requireLogin": true
}

SESI√ìN EXPIRADA (401):
{
  "error": "Sesi√≥n expirada o inv√°lida",
  "requireLogin": true
}

================================================================================
üìù NOTAS ADICIONALES
================================================================================

1. Todos los endpoints est√°n en el archivo: router/apiRouter.js
2. La l√≥gica de base de datos est√° en: modules/model.js
3. Los middlewares de validaci√≥n est√°n en: utils/middleware.js
4. Autenticaci√≥n de sesiones: utils/middleware.js (requireAuth, requirePrefecto)

5. Convenciones de nombres:
   - Backend: snake_case (nombre_carrera, id_grupo)
   - Frontend-Backend Usuario: camelCase (nombreUsuario, tipoUsuario)

6. IDs siempre son n√∫meros enteros positivos

7. Las fechas deben estar en formato ISO: YYYY-MM-DD

8. Los campos marcados como "IMPORTANTE" son los m√°s usados en el sistema

9. PERSISTENCIA DE DATOS:
   - Atenci√≥n de alumnos: Tabla Atenciones_Alumnos
   - Sesiones: express-session con MemoryStore
   - NO usar localStorage para datos cr√≠ticos

10. DEBUGGING:
    - Todos los console.log han sido removidos en producci√≥n
    - Para debugging, verificar req.session.user en servidor
    - Frontend: sessionStorage.getItem('loggingOut')

================================================================================
üîí SEGURIDAD Y MEJORES PR√ÅCTICAS
================================================================================

1. SIEMPRE usar { credentials: 'include' } en fetch()
2. Verificar sesi√≥n con GET /api/session antes de operaciones cr√≠ticas
3. Implementar manejo de errores 401 para redirigir a login
4. Limpiar sessionStorage.loggingOut despu√©s de usarlo
5. NO almacenar contrase√±as en localStorage
6. Validar todos los par√°metros num√©ricos con validateNumericId
7. Usar middleware requireAuth en rutas protegidas
8. Verificar roles de usuario antes de operaciones sensibles
9. Sanitizar entradas del usuario en el backend
10. Implementar rate limiting para prevenir abuso de API

================================================================================
üì¶ TABLAS DE BASE DE DATOS RELACIONADAS
================================================================================

PRINCIPALES:
- Carreras
- Semestres
- Materias
- Plan_Estudios
- Grupos
- Alumnos
- Maestros
- Horarios
- Asignaciones
- Asistencias
- Usuarios_Sistema
- Atenciones_Alumnos (NUEVA - para persistencia de atenci√≥n)

ESTRUCTURA DE Atenciones_Alumnos:
- id_atencion (PK)
- id_alumno (FK ‚Üí Alumnos)
- id_prefecto (FK ‚Üí Usuarios_Sistema)
- fecha_atencion (DATETIME)
- notas (TEXT, opcional)

================================================================================
√öltima actualizaci√≥n: 2025-10-23
Versi√≥n: 2.0
================================================================================
