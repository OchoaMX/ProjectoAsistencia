<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal de Prefectos - Alumnos Problem√°ticos</title>
    <link rel="stylesheet" href="/css/<%= cssFile %>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="/js/auth-common.js"></script>
</head>
<body>
    <div class="prefecto-container">
        <!-- Header -->
        <header class="prefecto-header">
            <div class="prefecto-header-content">
                <div class="prefecto-title">
                    <i class="fas fa-school icon"></i>
                    PORTAL DE PREFECTOS - Sistema de Asistencia Escolar
                </div>
                <div class="prefecto-user-info">
                    <span class="prefecto-user-name">
                        <i class="fas fa-user-circle"></i>
                        <%= user ? user.nombre : 'Usuario del Sistema' %>
                    </span>
                    <button onclick="cerrarSesion()" class="logout-btn">
                        <i class="fas fa-sign-out-alt"></i>
                        Cerrar Sesi√≥n
                    </button>
                </div>
            </div>
        </header>

        <!-- Navegaci√≥n -->
        <nav class="prefecto-nav">
            <div class="prefecto-nav-content">
                <a href="/prefecto/dashboard" class="nav-link">
                    <i class="fas fa-home"></i>
                    Dashboard
                </a>
                <a href="/prefecto/alumnos-problematicos" class="nav-link active">
                    <i class="fas fa-user-times"></i>
                    Alumnos Problem√°ticos
                </a>
                <a href="/prefecto/maestros-control" class="nav-link">
                    <i class="fas fa-chalkboard-teacher"></i>
                    Control Maestros
                </a>
            </div>
        </nav>

        <!-- Contenido Principal -->
        <main class="prefecto-main">
            <!-- Header de la secci√≥n -->
            <div class="prefecto-date-header fade-in">
                <div class="current-date">
                    <i class="fas fa-user-times"></i>
                    <span>ALUMNOS CON PROBLEMAS DE ASISTENCIA</span>
                </div>
                <div class="panel-actions">
                    <button class="action-btn ghost" onclick="limpiarFiltros()">
                        <i class="fas fa-eraser"></i>
                        Limpiar Filtros
                    </button>
                    <button class="action-btn success" onclick="exportarExcel()">
                        <i class="fas fa-file-excel"></i>
                        Exportar Excel
                    </button>
                    <button class="action-btn danger" onclick="exportarPDF()">
                        <i class="fas fa-file-pdf"></i>
                        Exportar PDF
                    </button>
                </div>
            </div>

            <!-- B√∫squeda Simplificada -->
            <div class="search-simple-section fade-in">
                <!-- B√∫squeda Principal GRANDE -->
                <div class="search-box-main">
                    <i class="fas fa-search"></i>
                    <input type="text" id="busquedaRapida" class="search-input-main" 
                           placeholder="üîç Buscar alumno por nombre, matr√≠cula o grupo (Ej: Juan, 5502, L√≥pez)..."
                           oninput="buscarEnTiempoReal()">
                </div>

                <!-- Botones de Per√≠odo GRANDES -->
                <div class="period-buttons">
                    <button class="period-btn active" data-periodo="7" onclick="cambiarPeriodoRapido(this, 7)">
                        <i class="fas fa-calendar-week"></i>
                        <span>√öltima Semana</span>
                        <small>7 d√≠as</small>
                    </button>
                    <button class="period-btn" data-periodo="30" onclick="cambiarPeriodoRapido(this, 30)">
                        <i class="fas fa-calendar-alt"></i>
                        <span>√öltimo Mes</span>
                        <small>30 d√≠as</small>
                    </button>
                    <button class="period-btn" data-periodo="90" onclick="cambiarPeriodoRapido(this, 90)">
                        <i class="fas fa-calendar"></i>
                        <span>3 Meses</span>
                        <small>90 d√≠as</small>
                    </button>
                </div>

                <!-- Bot√≥n para Filtros Avanzados -->
                <div class="advanced-filters-toggle">
                    <button class="toggle-advanced-btn" onclick="toggleFiltrosAvanzados()">
                        <i class="fas fa-sliders-h"></i>
                        <span id="toggleText">Mostrar Filtros Avanzados</span>
                        <i class="fas fa-chevron-down" id="toggleIcon"></i>
                    </button>
                </div>

                <!-- Filtros Avanzados (Ocultos por defecto) -->
                <div id="filtrosAvanzados" class="advanced-filters-panel" style="display: none;">
                    <div class="advanced-filters-grid">
                        <div class="filter-item">
                            <label><i class="fas fa-graduation-cap"></i> Carrera:</label>
                            <select id="filtroCarrera" class="filter-select-modern">
                                <option value="">Todas las carreras</option>
                            </select>
                        </div>
                        <div class="filter-item">
                            <label><i class="fas fa-layer-group"></i> Semestre:</label>
                            <select id="filtroSemestre" class="filter-select-modern">
                                <option value="">Todos los semestres</option>
                            </select>
                        </div>
                        <div class="filter-item">
                            <label><i class="fas fa-users"></i> Grupo:</label>
                            <select id="filtroGrupo" class="filter-select-modern">
                                <option value="">Todos los grupos</option>
                            </select>
                        </div>
                        <div class="filter-item">
                            <label><i class="fas fa-exclamation-triangle"></i> M√≠nimo de Faltas:</label>
                            <select id="filtroMinFaltas" class="filter-select-modern">
                                <option value="1" selected>1 o m√°s faltas</option>
                                <option value="3">3 o m√°s faltas</option>
                                <option value="5">5 o m√°s faltas</option>
                                <option value="10">10 o m√°s faltas</option>
                            </select>
                        </div>
                    </div>
                    <div class="advanced-filters-actions">
                        <button class="action-btn primary" onclick="aplicarFiltros()">
                            <i class="fas fa-search"></i>
                            Aplicar Filtros
                        </button>
                        <button class="action-btn ghost" onclick="limpiarFiltrosAvanzados()">
                            <i class="fas fa-times"></i>
                            Limpiar
                        </button>
                    </div>
                </div>

                <!-- Campo oculto para per√≠odo -->
                <input type="hidden" id="filtroPeriodo" value="7">
                <input type="hidden" id="filtroNombre" value="">
            </div>

            <!-- Resumen de resultados -->
            <div class="panel fade-in">
                <div class="panel-content" style="padding: 1rem;">
                    <div id="resumenResultados" class="flex items-center justify-between">
                        <div class="loading-spinner">
                            <div class="spinner"></div>
                            Cargando alumnos...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tabla de resultados -->
            <div class="panel fade-in">
                <div class="panel-header">
                    <h2 class="panel-title">
                        <i class="fas fa-list"></i>
                        Listado de Alumnos Problem√°ticos
                    </h2>
                    <div class="panel-actions">
                        <button class="action-btn ghost" onclick="toggleVisualizacion()">
                            <i class="fas fa-th-list"></i>
                            <span id="btnVisualizacion">Vista Tarjetas</span>
                        </button>
                    </div>
                </div>
                <div class="panel-content">
                    <!-- Vista de tabla -->
                    <div id="vistaTabla" class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Matr√≠cula</th>
                                    <th>Nombre Completo</th>
                                    <th>Grupo</th>
                                    <th>Semestre</th>
                                    <th class="text-center">‚úÖ Asist.</th>
                                    <th class="text-center">‚ùå Faltas</th>
                                    <th class="text-center">üìù Just.</th>
                                    <th class="text-center">% Asist.</th>
                                    <th class="text-center">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="tablaAlumnos">
                                <!-- Se llena din√°micamente -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Vista de tarjetas -->
                    <div id="vistaTarjetas" class="hidden">
                        <div id="tarjetasAlumnos" class="cards-grid">
                            <!-- Se llena din√°micamente -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Paginaci√≥n -->
            <div class="pagination" id="paginacionContainer">
                <!-- Se llena din√°micamente -->
            </div>
        </main>
    </div>

    <!-- Modal para acciones r√°pidas -->
    <div id="modalAcciones" class="modal hidden">
        <div class="modal-overlay" onclick="cerrarModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitulo">Acciones para Alumno</h3>
                <button class="modal-close" onclick="cerrarModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="modalDatos" class="student-info">
                    <!-- Se llena din√°micamente -->
                </div>
                <div class="actions-grid">
                    <button class="action-btn primary" onclick="verDetalle()">
                        <i class="fas fa-eye"></i>
                        Ver Detalle Completo
                    </button>
                    <button class="action-btn warning" onclick="generarCitatorio()">
                        <i class="fas fa-file-text"></i>
                        Generar Citatorio
                    </button>
                    <button class="action-btn success" onclick="marcarAtendido()">
                        <i class="fas fa-check-circle"></i>
                        Marcar como Atendido
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center;">
        <div style="background: white; padding: 2rem; border-radius: 8px; text-align: center;">
            <div class="loading-spinner">
                <div class="spinner"></div>
                Cargando datos...
            </div>
        </div>
    </div>

    <script src="/js/auth-utils.js"></script>
    <script src="/js/<%= jsFile %>"></script>
    
    <style>
        /* Estilos adicionales para este m√≥dulo */
        .table-container {
            overflow-x: auto;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .student-card {
            background: white;
            border: 1px solid var(--color-gray-200);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            transition: all 0.2s;
        }

        .student-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .student-card.critical {
            border-left: 4px solid var(--color-danger);
        }

        .student-card.warning {
            border-left: 4px solid var(--color-warning);
        }

        .student-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .student-info h4 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--color-gray-800);
        }

        .student-info p {
            margin: 0.25rem 0;
            color: var(--color-gray-600);
            font-size: 0.875rem;
        }

        .student-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin: 1rem 0;
        }

        .stat-item {
            text-align: center;
            padding: 0.75rem;
            background: var(--color-gray-50);
            border-radius: var(--border-radius);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--color-gray-600);
            font-weight: 600;
        }

        .student-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: space-between;
        }

        /* Modal styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1050;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal.hidden {
            display: none;
        }

        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            z-index: 1;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid var(--color-gray-200);
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.25rem;
            cursor: pointer;
            padding: 0.5rem;
            color: var(--color-gray-500);
        }

        .modal-close:hover {
            color: var(--color-gray-800);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1.5rem;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .cards-grid {
                grid-template-columns: 1fr;
            }

            .actions-grid {
                grid-template-columns: 1fr;
            }

            .student-actions {
                flex-direction: column;
            }

            .student-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>
</html>
